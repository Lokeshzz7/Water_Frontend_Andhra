<!-- Styles -->
<style>
  #chartdiv {
    width: 100%;
    height: 600px;
  }
</style>

<!-- Resources -->
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/map.js"></script>
<script src="https://cdn.amcharts.com/lib/5/geodata/indiaLow.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

<!-- Chart Code -->
<script>
  am5.ready(function () {
    // Create root and chart
    var root = am5.Root.new("chartdiv");
    root.setThemes([am5themes_Animated.new(root)]);

    var chart = root.container.children.push(
      am5map.MapChart.new(root, {
        projection: am5map.geoMercator(),
      })
    );

    // Create polygon series for the states
    var polygonSeries = chart.series.push(
      am5map.MapPolygonSeries.new(root, {
        geoJSON: am5geodata_indiaLow,
      })
    );

    // Configure state polygons
    polygonSeries.mapPolygons.template.setAll({
      tooltipText: "{name}",
      interactive: true,
      fill: am5.color(0x74b9ff),
      stroke: am5.color(0xffffff),
      strokeWidth: 1,
    });

    // Add hover behavior
    polygonSeries.mapPolygons.template.states.create("hover", {
      fill: am5.color(0x0984e3),
    });

    // Zoom to the clicked state
    polygonSeries.mapPolygons.template.events.on("click", function (ev) {
      // Zoom into the clicked state
      polygonSeries.zoomToDataItem(ev.target.dataItem);
    });

    // Add label inside the state after click
    polygonSeries.mapPolygons.template.events.on("click", function (event) {
      var target = event.target;
      var dataItem = target.dataItem;

      // Add label with state name inside the clicked state
      var stateLabel = target.children.push(
        am5.Label.new(root, {
          text: dataItem.dataContext.name,
          fill: am5.color(0xffffff),
          fontSize: 14,
          fontWeight: "bold",
          centerX: am5.p50,
          centerY: am5.p50,
          populateText: true,
        })
      );

      // Ensure the label remains centered during zoom
      stateLabel.adapters.add("x", function () {
        return target.x();
      });
      stateLabel.adapters.add("y", function () {
        return target.y();
      });
    });

    // Create a point series for the cities
    var pointSeries = chart.series.push(
      am5map.MapPointSeries.new(root, {
        valueField: "value",
        calculateAggregates: true,
      })
    );

    // Configure the city pins
    pointSeries.bullets.push(function (root, series, dataItem) {
      return am5.Bullet.new(root, {
        sprite: am5.Circle.new(root, {
          radius: 5,
          tooltipText: "{title}",
          fill: am5.color(0xff0000),
          stroke: am5.color(0xffffff),
          strokeWidth: 2,
        }),
      });
    });

    // Add data for cities
    pointSeries.data.setAll([
      {
        geometry: { type: "Point", coordinates: [80.27, 13.08] }, // Chennai
        title: "Chennai",
      },
      {
        geometry: { type: "Point", coordinates: [72.88, 19.07] }, // Mumbai
        title: "Mumbai",
      },
      {
        geometry: { type: "Point", coordinates: [77.59, 12.97] }, // Bangalore
        title: "Bangalore",
      },
      {
        geometry: { type: "Point", coordinates: [77.10, 28.70] }, // Delhi
        title: "Delhi",
      },
    ]);

    // Enable zoom control
    var zoomControl = chart.set("zoomControl", am5map.ZoomControl.new(root, {}));
    zoomControl.homeButton.set("visible", true);

    // Center map on India
    chart.appear(1000, 100);
  });
</script>

<!-- HTML -->
<div id="chartdiv"></div>